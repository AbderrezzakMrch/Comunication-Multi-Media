<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Segmentation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Step 2: Video Segmentation</h1>
        
        <div class="video-selector">
            <label for="videoSelect">Select Video:</label>
            <select id="videoSelect">
                <option value="">-- Select a video --</option>
                {% for video_id, video in videos.items() %}
                <option value="{{ video_id }}">{{ video.filename }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div id="videoInfo" class="video-info" style="display: none;">
            <h3>Video Information</h3>
            <p id="videoName"></p>
            <p id="videoDuration"></p>
        </div>
        
        <div class="segment-controls">
            <label for="segmentCount">Number of Segments:</label>
            <input type="number" id="segmentCount" min="1" max="20" value="6">
            <button id="segmentButton" onclick="segmentVideo()">Create Segments</button>
        </div>
        
        <div id="segmentResult" class="result-container" style="display: none;"></div>
        
        <!-- Display Original Segments -->
        <div class="segments-section">
            <h2>Original Video Segments</h2>
            <div id="segmentsContainer">
                {% for video_id, video in videos.items() %}
                    {% if video.original_segments %}
                    <div class="video-segments">
                        <h3>{{ video.filename }} - Original Segments</h3>
                        <div class="segments-grid">
                            {% for segment_id, segment in video.original_segments.items() %}
                            <div class="segment-card">
                                <div class="video-player">
                                    <video controls>
                                        <source src="{{ url_for('get_segment_file', video_id=video_id, resolution='original', segment_id=segment_id) }}" type="video/mp4">
                                        Your browser does not support the video tag.
                                    </video>
                                </div>
                                <div class="segment-info">
                                    <h4>Segment {{ segment_id }}</h4>
                                    <p>Start: {{ "%.2f"|format(segment.start_time) }}s</p>
                                    <p>Duration: {{ "%.2f"|format(segment.duration) }}s</p>
                                    <p>Resolution: Original</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>

            {# ✅ FIXED: safe Jinja logic instead of Python any(...) #}
            {% set has_segments = false %}
            {% for video in videos.values() %}
                {% if video.original_segments %}
                    {% set has_segments = true %}
                {% endif %}
            {% endfor %}

            {% if not videos or not has_segments %}
                <p class="no-segments">No segments created yet. Select a video and create segments above.</p>
            {% endif %}
        </div>
        
        <div class="navigation">
            <a href="/" class="nav-button">← Back to Upload</a>
            <a href="/resolution" class="nav-button">Go to Step 3: Resolutions →</a>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
